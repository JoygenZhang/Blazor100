@page "/"
@using b03sqlite.Data

<PageTitle>Index</PageTitle>
<Button Text="导入" OnClick="Import" />
<Button Text="导出" OnClick="Export" />
<Button Text="模板" OnClick="Temple" />

<Table TItem="WeatherForecast"
       IsPagination="true"
       IsStriped="true"
       IsBordered="true"
       AutoGenerateColumns="true"
       ShowSearch="true"
       ShowToolbar="true"
       ShowExtendButtons="true"
       DoubleClickToEdit=true
       ShowColumnList=true
       ShowCardView=true>
</Table>

@code{
    // 由于使用了FreeSql ORM 数据服务,可以直接取对象
    [Inject] IFreeSql? fsql { get; set; }
    [Inject] ImportExportsService? importExportsService { get; set; }
    [Inject] ToastService? toastService { get; set; }

    //用演示服务的数据初始化数据库
    [Inject] WeatherForecastService? ForecastService { get; set; }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            //懒的人,直接初始化一些数据用用
            var res = fsql!.Select<WeatherForecast>().Count();
            if (res == 0)
            {
                var forecasts = (await ForecastService!.GetForecastAsync(DateTime.Now)).ToList();
                fsql.Insert<WeatherForecast>().AppendData(forecasts).ExecuteAffrows();
            }
        }
    }

    async Task Import()
    {
    }
    async Task Export()
    {
        var forecasts = (await ForecastService!.GetForecastAsync(DateTime.Now)).ToList();
        var file = await importExportsService.ExportToExcel<WeatherForecast>(null, forecasts);
        await toastService.Success($"导出 {file}");
    }
    async Task Temple()
    {

    }

}